{%extends 'base.html'%}
{% block body_block%}

<style>
  h1 {
    font-size: 45px;
  }

  #home-btn {
    margin-left: 100%;
    border: 2px solid darkslateblue;
    transform: scale(1.2);
    color: rgb(35, 109, 245) !important;
  }

  #form {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    width: 100%;
    grid-column-gap: 7rem;
  }

  #pie-cont {
    width: 450px;
    height: 450px;
    border: 1px solid black;
    border-radius: 10px;
    padding: 15px;
    margin: 3rem auto 1rem auto;
  }

  #linechart {
    width: 950px;
    height: 450px;
    border: 1px solid black;
    border-radius: 10px;
    padding: 15px;
  }

  .center {
    width: fit-content;
    margin-left: auto;
    margin-right: auto;
  }

  #charts {
    display: flex;
    justify-content: space-between;
  }

  .input-fields {
    padding: 10px;
    border-radius: 10px;
    margin-top: 15px;
    border: 1px solid rgb(80, 80, 80);
    outline: none;
  }

  #date-alert {
    color: rgb(190, 8, 47);
  }

  #submit-btn {
    transform: scale(1.5);
  }

  .hel {
    margin-left: 58rem;
  }

  #pie-flex {
    display: flex;
    column-gap: 5rem;
    align-items: center;
  }

  #other-date {
    border: 1px solid black;
    border-radius: 5px;
    padding: 20px;
    height: fit-content;
  }

  hr {
    background: black;
    height: 2px;
    opacity: 1;
  }

  h6 {
    color: rgb(80, 80, 80);
    font-size: small;
  }
</style>
<br>
<div class="hel">

</div>

<br>

<div class="center">
  <h2 id="date-alert">{% include 'messages.html' %}</h2>
  <form method="POST">
    <div id="form">
      {% csrf_token %}

      <div>
        <h2 id="selectdate">Select From Date</h2>
        <input class="input-fields" type="date" id="fromdate" name="fromdate" required>
      </div>
      <div>
        <h2 id="selectdate">Select To Date</h2>
        <input class="input-fields" type="date" id="todate" name="todate" required>
      </div>
      <div>
        <h2 id="meal">Select Meal Type</h2>
        <select class="input-fields" name="mealtype" method="GET">
          <option value="all" SELECTED>ALL</option>
          <option value="Breakfast" SELECTED>Breakfast</option>
          <option value="Lunch" SELECTED>Lunch</option>
          <option value="Snacks" SELECTED>Snacks</option>
          <option value="Dinner" SELECTED>Dinner</option>
          <option SELECTED>Select </option>
        </select>
      </div>
    </div>
    <br>
    <br>
    <div class="center">
      <br>
      <a href="userfoodlogchart"><button class="btn btn-outline-primary" type="submit" formaction="userfoodlogchart"
          id="submit-btn">Submit</button></a>
    </div>
    <br>
  </form>
</div>
<hr>
<br><br>
<h3 class="text-center">Calorie Analysis From '{{fromdate}}' To '{{todate}}'</h3>
<br>
<div class="center">
  <div id="charts">
    <div id="linechart">
      <div id="curve_chart" style="width: 900px; height: 420px"></div>
    </div>
  </div>
  <h6>*The graph above is showing data only for the dates when any data is recorded. If any date is not present, that
    means no data was recorded for that date.</h6>
</div>
<br>
<hr>
<div class="container">
  <br>
  <div class="center">
    <div id="pie-flex">
      <div>
        <h2 style="text-align: center;">Calorie Analysis for Today</h2>
        <div id="pie-cont">
          <div id="piechart_3d"></div>
        </div>
      </div>
      <div id="other-date">
        <h5>For Calorie Analysis Of Another Date</h5>
        <a href="{%url 'home_app_new:otherdayanalysis'%}" style="font-size: 1.5rem;">Click Here</a>
      </div>
    </div>

  </div>
  <br>
  <br>
  <br>
  <script type="text/javascript">
    var data = JSON.parse("{{data|escapejs}}");
    var list = []
    var date = data[0]["date"]
    //var mt = data[0]["meal_type"]
    //console.log(date)
    for (let i = 0; i < data.length; i++) {
      list.push([data[i]["food_name"], parseInt(data[i]["calorie"])])
    }
    console.log(list)
    google.charts.load("current", { packages: ["corechart"] });
    google.charts.setOnLoadCallback(drawChart);
    function drawChart() {

      var data = google.visualization.arrayToDataTable([
        ["FoodName", "Calorie"],
        ...list
      ]);

      var options = {
        titleTextStyle: {
          fontSize: 20,
          bold: true,
        },
        title: 'Calories Consumption On ' + date,
        is3D: true,
        width: 430,
        height: 420
      };

      var chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
      chart.draw(data, options);
    }

  </script>



  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    var cal_data = JSON.parse("{{cal_data|escapejs}}");
    var list2 = []
    //var date = data[0]["date"]
    //console.log(date)
    for (let i = 0; i < cal_data.length; i++) {
      list2.push([cal_data[i]["date"], parseInt(cal_data[i]["sum"]), parseInt(cal_data[i]["min. calories req. for women"]), parseInt(cal_data[i]["min. calories req. for men"])])
    }
    console.log(list2)
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = google.visualization.arrayToDataTable([
        ['Date', 'Calories Consumed', "Daily Min. Calories Req. For Women", "Daily Min. Calories Req. For Men"],
        ...list2
      ]);

      var options = {
        titleTextStyle: {
          fontSize: 20,
          bold: true,
        },
        title: 'Date-wise Total Calorie Intake',
        legend: { position: 'right' },
        series: {
          0: { color: '#041c4d' },
          1: { color: '#cd38f2' },
          2: { color: '#38baf2' },
        }
      }

      var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

      chart.draw(data, options);
    }
  </script>
  {% endblock %}